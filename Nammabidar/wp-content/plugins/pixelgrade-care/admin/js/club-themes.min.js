import _ from"lodash";!function(e,s){s(document).on("click",".club-install-theme",(function(e){e.preventDefault();let a=s(this),t=a.closest(".theme");if(a.hasClass("disabled")||a.hasClass("updating-message"))return;let r=a.data("url"),l=a.data("slug"),d=a.data("sku"),i="yes"===a.data("is-lt-theme")?"yes":"";a.closest(".theme").find(".theme-install-error").remove(),t.addClass("installed"),a.removeClass("button-primary"),a.addClass("disabled"),a.addClass("updating-message"),a.text("Installing..."),s.ajax({url:pixcare.wpRest.endpoint.installTheme.url,method:pixcare.wpRest.endpoint.installTheme.method,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",pixcare.wpRest.nonce)},data:{download_url:r,slug:l,sku:d,is_lt_theme:i,pixcare_nonce:pixcare.wpRest.pixcare_nonce},success:function(e){if(_.isUndefined(e.code)||"success"!==e.code){if(!_.isEmpty(e.data.errors)){a.removeClass("disabled"),a.removeClass("updating-message"),a.text("Install"),t.removeClass("installed");let s="";switch(Object.keys(e.data.errors)[0]){case"mkdir_failed_destination":s="The theme could not be installed. Please check if your current user has write permissions on the themes folder of your WordPress installation.";break;case"no_package":s=e.data.errors.errors.no_package;break;case"download_failed":s=e.data.errors.errors.download_failed;break;default:s="An unexpected error occurred. Please contact us at help@pixelgrade.com"}a.closest(".theme").find(".theme-screenshot").prepend('<div class="error theme-install-error">'+s+"</div>")}}else a.addClass("button-primary"),a.removeClass("disabled"),a.removeClass("club-install-theme"),a.removeClass("updating-message"),a.addClass("club-activate-theme"),a.text("Activate")}})})),s(document).on("click",".club-activate-theme",(function(a){a.preventDefault();let t=s(this),r=t.data("slug"),l=t.data("sku"),d="yes"===t.data("is-lt-theme")?"yes":"";t.removeClass("button-primary"),t.addClass("disabled"),t.addClass("updating-message"),t.text("Activating..."),s.ajax({url:pixcare.wpRest.endpoint.activateTheme.url,method:pixcare.wpRest.endpoint.activateTheme.method,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",pixcare.wpRest.nonce)},data:{slug:r,sku:l,is_lt_theme:d,pixcare_nonce:pixcare.wpRest.pixcare_nonce},success:function(s){"success"===s.code?e.location.href=pixcare.themesUrl:(t.addClass("button-primary"),t.removeClass("disabled"),t.removeClass("updating-message"),t.text("Activate"),t.closest(".theme").find(".theme-screenshot").prepend('<div class="error theme-install-error">'+s.message+"</div>"))}})}))}(window,jQuery);